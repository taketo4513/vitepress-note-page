# 索引概述

## 定义

索引（index）是帮助MySQL高效获取数据的数据结构(有序)。

在数据之外，数据库系统还维护着满足 **特定查找算法的数据结构**，这些数据结构以某种方式引用（指向）数据， 这样就可以在这些数据结构 上实现高级查找算法，这种**数据结构就是索引**。

无索引情况

在无索引情况下，就需要从第一行开始扫描，一直扫描到最后一行，我们称之为 **全表扫描**，性能很低。

## 特点

| 优势                                                     | 劣势                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 提高数据检索的效率，降低数据库的IO成本                       | 索引列也是要占用空间的。                                     |
| 通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗。 | 索引大大提高了查询效率，同时却也降低更新表的速度，如对表进行INSERT、UPDATE、DELETE时，效率降低。 |

## 索引分类

在MySQL数据库，将索引的具体类型主要分为以下几类：**主键索引、唯一索引、常规索引、全文索引**。

| 分类     | 含义                                             | 特点                 | 关键字   |
| ------------ | ---------------------------------------------------- | ------------------------ | ------------ |
| **主键索引** | 针对于表中主键创建的索引                             | 默认自动创建, 只能有一个 | **PRIMARY**  |
| **唯一索引** | 避免同一个表中某数据列中的值重复                     | 可以有多个               | **UNIQUE**   |
| **常规索引** | 快速定位特定数据                                     | 可以有多个               |              |
| **全文索引** | 全文索引查找的是文本中的关键词，而不是比较索引中的值 | 可以有多个               | **FULLTEXT** |

### 聚集索引&二级索引

而在在InnoDB存储引擎中，根据索引的存储形式，又可以分为以下两种：

| 分类                      | 含义                                                   | 特点             |
| ----------------------------- | ---------------------------------------------------------- | -------------------- |
| **聚集索引(Clustered Index)** | 将数据存储与索引放到了一块，索引结构的叶子节点保存了行数据 | 必须有，而且只有一个 |
| **二级索引(Secondary Index)** | 将数据与索引分开存储，索引结构的叶子节点关联的是对应的主键 | 可以存在多个         |

### 聚集索引选取规则

- 如果存在主键，主键索引就是聚集索引。
- 如果不存在主键，将使用第一个唯一（UNIQUE）索引作为聚集索引。
- 如果表没有主键，或没有合适的唯一索引，则InnoDB会自动生成一个rowid作为隐藏的聚集索引。

聚集索引和二级索引的具体结构如下：

![An image](/img/dev/mysql/24.png)

> 聚集索引的叶子节点下挂的是这一行的数据。
>
> 二级索引的叶子节点下挂的是该字段值对应的主键值。

接下来，我们来分析一下，当我们执行如下的SQL语句时，具体的查找过程是什么样子的。

![An image](/img/dev/mysql/25.png)

具体过程如下:

1. 由于是根据name字段进行查询，所以先根据name='Arm'到name字段的二级索引中进行匹配查找。但是在二级索引中只能查找到 Arm 对应的主键值 10。
2. 由于查询返回的数据是*，所以此时，还需要根据主键值10，到聚集索引中查找10对应的记录，最终找到10对应的行row。
3. 最终拿到这一行的数据，直接返回即可。

> 回表查询
>
> 这种先到二级索引中查找数据，找到主键值，然后再到聚集索引中根据主键值，获取数据的方式，就称之为回表查询。

思考

以下两条SQL语句，那个执行效率高? 为什么?

```sql
A. select * from user where id = 10 ;

B. select * from user where name = 'Arm' ;
```

> id为主键，name字段创建的有索引；

解答

A 语句的执行性能要高于B 语句。因为A语句直接走聚集索引，直接返回数据。 而B语句需要先查询name字段的二级索引，然后再查询聚集索引，也就是需要进行回表查询。
